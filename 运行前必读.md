# React Native 项目运行前必读

## 当前状态

- **Node 依赖**：已安装（根目录 `MyRNProject/node_modules` 存在）
- **运行入口**：已配置 `react-native.config.js`，在根目录 `MyRNProject/` 下执行 `npm run ios` / `npm run android` 会正确找到子目录里的 iOS/Android 工程
- **iOS 构建**：尚未能跑通，因为 **CocoaPods 依赖未安装完成**（见下方）

---

## 必须解决的问题

### 1. 完成 iOS 的 `pod install`（当前卡在这里）

iOS 工程依赖 CocoaPods，必须先执行成功一次 `pod install`，否则 Xcode 会报错找不到 `Pods-MyRNProject.debug.xcconfig` 等文件。

**步骤：**

1. **设置终端为 UTF-8**（否则 CocoaPods 会报编码错误）  
   在 `~/.zshrc` 里加上：
   ```bash
   export LANG=en_US.UTF-8
   export LC_ALL=en_US.UTF-8
   ```
   然后执行 `source ~/.zshrc` 或新开一个终端。

2. **进入 iOS 目录并执行 pod install**：
   ```bash
   cd /Users/usea/conpany1/MyRNProject/MyRNProject/ios
   pod install
   ```

3. **若出现 SSL 证书错误**（例如：`certificate verify failed (unable to get local issuer certificate)`）  
   说明本机 Ruby/OpenSSL 无法校验 HTTPS 证书，请**用系统自带的「终端」App**（不要用 Cursor 内置终端）依次尝试：

   **方案 A：指定证书文件再执行**（若已装 Homebrew）  
   ```bash
   export LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8
   export SSL_CERT_FILE=/opt/homebrew/etc/openssl@3/cert.pem
   cd /Users/usea/conpany1/MyRNProject/MyRNProject/ios
   pod install
   ```
   若 `/opt/homebrew/etc/openssl@3/cert.pem` 不存在，先执行：`brew install openssl@3` 或 `brew reinstall ca-certificates`。

   **方案 B：从系统钥匙串导出证书再执行**  
   ```bash
   cert_file="$HOME/.macos-certs.pem"
   security find-certificate -a -p /Library/Keychains/System.keychain > "$cert_file"
   security find-certificate -a -p /System/Library/Keychains/SystemRootCertificates.keychain >> "$cert_file"
   export LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8
   export SSL_CERT_FILE="$cert_file"
   cd /Users/usea/conpany1/MyRNProject/MyRNProject/ios
   pod install
   ```

   **其他可尝试**：  
   - 关闭 VPN/代理后再执行 `pod install`  
   - 检查系统日期时间是否正确  
   - 执行 `gem update --system` 后重试  
   - 若公司网络有 SSL 拦截，需按 IT 要求安装并信任对应根证书

`pod install` 成功后，会在 `MyRNProject/MyRNProject/ios/` 下生成 `Podfile.lock` 和 `MyRNProject.xcworkspace`，之后用 Xcode 或 CLI 都应打开 **`.xcworkspace`** 来编译运行。

---

### 2. 之后如何运行

在项目**根目录** `MyRNProject/` 下（即和 `package.json` 同级）：

```bash
# 先启动 Metro（可选，run-ios/run-android 也会自动起）
npm start

# 另开终端：跑 iOS
npm run ios

# 或跑 Android
npm run android
```

不需要再进 `MyRNProject/MyRNProject/` 执行，当前 `react-native.config.js` 已把 iOS/Android 路径指到子目录。

---

## 项目结构说明

- `MyRNProject/`（根）：`package.json`、`node_modules`、`App.tsx`、`react-native.config.js`
- `MyRNProject/MyRNProject/`：同名子目录，内有 `ios/`、`android/` 和另一份 `package.json`  
Podfile 里通过 `../../node_modules` 使用根目录的 `node_modules`，所以依赖只需在根目录安装一次即可。

---

## 已处理过的问题

1. **Git 镜像**：已去掉全局的 `github.com` → `github.com.cnpmjs.org` 替换，clone 使用官方 GitHub，CocoaAsyncSocket 等依赖不再因镜像解析失败。
2. **运行目录**：已通过 `react-native.config.js` 的 `project.ios.sourceDir` / `project.android.sourceDir` 指向 `MyRNProject/ios` 和 `MyRNProject/android`，从根目录即可 `npm run ios` / `npm run android`。

当前唯一阻塞运行的是：**在 UTF-8 环境下成功执行一次 `pod install`**（若遇 SSL 问题需按上面第 3 步排查）。
